<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="pageTitle">Job Details</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .gradient-purple {
            background: linear-gradient(135deg, #9333ea 0%, #4f46e5 100%);
        }
        
        /* ËÅå‰ΩçÊèèËø∞Ê†∑Âºè‰ºòÂåñ */
        .job-description {
            line-height: 1.8;
            color: #374151;
        }
        .job-description h1, .job-description h2, .job-description h3 {
            font-weight: bold;
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
            color: #111827;
        }
        .job-description h1 { font-size: 1.75rem; }
        .job-description h2 { font-size: 1.5rem; }
        .job-description h3 { font-size: 1.25rem; }
        .job-description p {
            margin-bottom: 1rem;
        }
        .job-description ul, .job-description ol {
            margin-left: 1.5rem;
            margin-bottom: 1rem;
            list-style-position: outside;
        }
        .job-description ul {
            list-style-type: disc;
        }
        .job-description li {
            margin-bottom: 0.5rem;
            padding-left: 0.25rem;
        }
        .job-description a {
            color: #2563eb;
            text-decoration: underline;
        }
        .job-description strong {
            font-weight: 600;
            color: #111827;
        }
    </style>
</head>
<body class="bg-gray-50">
    
    <div class="bg-white border-b sticky top-0 z-10 shadow">
        <div class="max-w-4xl mx-auto px-4 py-4">
            <a href="search-real.html" class="text-blue-600 hover:underline">
                ‚Üê Back to Search
            </a>
        </div>
    </div>

    <div id="jobContent" class="max-w-4xl mx-auto px-4 py-8">
        <div class="text-center py-12">
            <div class="text-5xl mb-4">‚è≥</div>
            <p>Loading...</p>
        </div>
    </div>

    <script>
        const INDEED_PUBLISHER_ID = 'YOUR_INDEED_ID';
        const ZIPRECRUITER_AID = 'YOUR_ZR_ID';
        const CJ_AFFILIATE_ID = 'YOUR_CJ_ID';

        let job = null;
        let companyName = '';

        async function loadJobDetails() {
            const urlParams = new URLSearchParams(window.location.search);
            const jobId = urlParams.get('id');
            
            if (!jobId) {
                showError('Job ID not found');
                return;
            }

            try {
                // ‰ªésearch-index.jsonËé∑ÂèñÂü∫Êú¨‰ø°ÊÅØ
                const indexResponse = await fetch('search-index.json');
                const index = await indexResponse.json();
                job = index.jobs.find(j => String(j.id) === String(jobId));
                
                if (!job) {
                    showError('Job not found');
                    return;
                }
                
                companyName = job.company;
                
                // Á´ãÂç≥ÊòæÁ§∫Âü∫Êú¨‰ø°ÊÅØÂíåËÅîÁõüÊåâÈíÆ
                renderBasicInfo(job);
                
                // ÂºÇÊ≠•Âä†ËΩΩÂÆåÊï¥ÊèèËø∞
                loadFullDescription(job);
                
            } catch (error) {
                console.error('Error:', error);
                showError('Failed to load job');
            }
        }

        function renderBasicInfo(job) {
            document.getElementById('pageTitle').textContent = `${job.title} at ${companyName}`;
            
            const affiliateLinks = {
                indeed: generateIndeedLink(job),
                ziprecruiter: generateZipRecruiterLink(job),
                glassdoor: generateGlassdoorLink(companyName)
            };
            
            document.getElementById('jobContent').innerHTML = `
                <h1 class="text-4xl font-bold mb-2">${job.title}</h1>
                <p class="text-xl text-gray-600 mb-6">
                    ${companyName} ‚Ä¢ ${job.location}
                </p>

                <!-- üí∞ Apply Buttons (Á´ãÂç≥ÊòæÁ§∫) -->
                <div class="bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg shadow-lg p-6 mb-8">
                    <h2 class="text-2xl font-bold mb-4">Apply to this job</h2>
                    
                    <a href="${job.url}" target="_blank"
                       class="block w-full bg-green-600 hover:bg-green-700 text-white text-center font-bold py-4 px-6 rounded-lg mb-3 transition shadow-md">
                        ‚úÖ Apply on ${companyName} Career Page
                    </a>

                    <a href="${affiliateLinks.indeed}" target="_blank"
                       onclick="trackClick('indeed')"
                       class="block w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-6 rounded-lg mb-3 transition shadow-md">
                        <div class="flex items-center justify-center">
                            <span class="text-2xl mr-2">‚≠ê</span>
                            <div class="text-left">
                                <div class="text-lg">Apply via Indeed</div>
                                <div class="text-sm font-normal opacity-90">
                                    üí∞ Also browse 1,000+ similar ${job.title} jobs
                                </div>
                            </div>
                        </div>
                    </a>

                    <a href="${affiliateLinks.ziprecruiter}" target="_blank"
                       onclick="trackClick('ziprecruiter')"
                       class="block w-full border-2 border-blue-600 hover:bg-blue-50 text-blue-600 font-bold py-4 px-6 rounded-lg transition">
                        <div class="text-lg">Apply via ZipRecruiter</div>
                        <div class="text-sm font-normal">üí∞ One-click apply to multiple jobs</div>
                    </a>
                </div>

                <!-- Job Description (ÂºÇÊ≠•Âä†ËΩΩ) -->
                <div class="bg-white rounded-lg shadow p-6 mb-8">
                    <h2 class="text-2xl font-bold mb-4">Job Description</h2>
                    <div id="jobDescription" class="job-description">
                        <div class="flex items-center py-8">
                            <div class="animate-spin rounded-full h-10 w-10 border-b-2 border-blue-600 mr-3"></div>
                            <span class="text-gray-600">Loading description...</span>
                        </div>
                    </div>
                </div>

                <!-- Glassdoor -->
                <div class="gradient-purple text-white rounded-lg shadow-lg p-6 mb-8">
                    <h3 class="text-2xl font-bold mb-4">
                        üí° Before you apply, learn more about ${companyName}
                    </h3>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                        <div class="bg-white bg-opacity-20 rounded-lg p-4">
                            <div class="text-4xl mb-2">‚≠ê</div>
                            <div class="font-bold">Employee Reviews</div>
                            <div class="text-sm opacity-90">See what employees say</div>
                        </div>
                        <div class="bg-white bg-opacity-20 rounded-lg p-4">
                            <div class="text-4xl mb-2">üí∞</div>
                            <div class="font-bold">Salary Data</div>
                            <div class="text-sm opacity-90">Know your worth</div>
                        </div>
                        <div class="bg-white bg-opacity-20 rounded-lg p-4">
                            <div class="text-4xl mb-2">üíº</div>
                            <div class="font-bold">Interview Tips</div>
                            <div class="text-sm opacity-90">Real questions</div>
                        </div>
                    </div>

                    <a href="${affiliateLinks.glassdoor}" target="_blank"
                       onclick="trackClick('glassdoor')"
                       class="block w-full bg-white text-purple-600 text-center font-bold py-4 px-6 rounded-lg hover:bg-gray-100 transition">
                        üí∞ View ${companyName} on Glassdoor ‚Üí
                    </a>
                </div>

                <p class="text-xs text-gray-500 text-center">
                    Disclosure: Some links are affiliate links. We may earn a commission.
                </p>
            `;
        }

        async function loadFullDescription(job) {
            try {
                const apiUrl = `https://boards-api.greenhouse.io/v1/boards/${companyName}/jobs/${job.id}`;
                
                console.log('üì° Fetching job description from Greenhouse API...');
                
                const response = await fetch(apiUrl);
                const fullJob = await response.json();
                
                if (fullJob.content) {
                    // Ê∏ÖÁêÜHTMLÔºàÁßªÈô§WordÁ≤òË¥¥ÁöÑÂÜó‰ΩôÂ±ûÊÄßÔºâ
                    const cleanedHtml = cleanHtml(fullJob.content);
                    
                    document.getElementById('jobDescription').innerHTML = cleanedHtml;
                    console.log('‚úÖ Description loaded:', cleanedHtml.length, 'characters');
                } else {
                    showNoDescription(job);
                }
                
            } catch (error) {
                console.error('Failed to load description:', error);
                showNoDescription(job);
            }
        }

        function cleanHtml(html) {
            // ÊñπÊ°àÔºöËΩ¨Êç¢ÊàêÁ∫ØÊñáÊú¨Ôºå‰øùÁïôÂü∫Êú¨Ê†ºÂºè
            // ÂàõÂª∫‰∏¥Êó∂DOMÂÖÉÁ¥†Êù•Ëß£ÊûêHTML
            const temp = document.createElement('div');
            temp.innerHTML = html;
            
            // ËΩ¨Êç¢ÊàêÊ†ºÂºèÂåñÁöÑÁ∫ØÊñáÊú¨
            let result = '';
            
            function processNode(node) {
                if (node.nodeType === Node.TEXT_NODE) {
                    const text = node.textContent.trim();
                    if (text && text !== '&nbsp;') {
                        result += text + ' ';
                    }
                } else if (node.nodeType === Node.ELEMENT_NODE) {
                    const tag = node.tagName.toLowerCase();
                    
                    // Â§ÑÁêÜ‰∏çÂêåÊ†áÁ≠æ
                    if (tag === 'h1' || tag === 'h2' || tag === 'h3') {
                        result += '\n\n### ';
                        node.childNodes.forEach(processNode);
                        result += '\n';
                    } else if (tag === 'p') {
                        result += '\n\n';
                        node.childNodes.forEach(processNode);
                    } else if (tag === 'strong' || tag === 'b') {
                        result += '**';
                        node.childNodes.forEach(processNode);
                        result += '**';
                    } else if (tag === 'ul' || tag === 'ol') {
                        result += '\n';
                        node.childNodes.forEach(processNode);
                        result += '\n';
                    } else if (tag === 'li') {
                        result += '\n‚Ä¢ ';
                        node.childNodes.forEach(processNode);
                    } else if (tag === 'br') {
                        result += '\n';
                    } else {
                        // ÂÖ∂‰ªñÊ†áÁ≠æÂè™ÊèêÂèñÂÜÖÂÆπ
                        node.childNodes.forEach(processNode);
                    }
                }
            }
            
            temp.childNodes.forEach(processNode);
            
            // Ê∏ÖÁêÜÂ§ö‰ΩôÁ©∫Ë°å
            result = result.replace(/\n{3,}/g, '\n\n');
            result = result.replace(/^\s+|\s+$/g, '');
            
            // ËΩ¨Êç¢ÊàêHTMLÊòæÁ§∫Ôºà‰øùÁïôÊç¢Ë°åÂíåÊ†ºÂºèÔºâ
            result = result
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/###\s+(.*?)\n/g, '<h3 class="text-xl font-bold mt-6 mb-3">$1</h3>')
                .replace(/‚Ä¢\s+(.*?)(?=\n|$)/g, '<li>$1</li>')
                .replace(/(<li>.*<\/li>\n?)+/g, '<ul class="list-disc ml-6 mb-4 space-y-2">$&</ul>')
                .replace(/\n\n/g, '</p><p class="mb-4">');
            
            return '<p class="mb-4">' + result + '</p>';
        }

        function showNoDescription(job) {
            document.getElementById('jobDescription').innerHTML = `
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-6">
                    <p class="text-gray-700 mb-4">
                        Full job description is available on the company's career page.
                    </p>
                    <a href="${job.url}" target="_blank"
                       class="inline-block bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded transition">
                        View Full Details on ${companyName} ‚Üí
                    </a>
                </div>
            `;
        }

        function showError(message) {
            document.getElementById('jobContent').innerHTML = `
                <div class="text-center py-12">
                    <div class="text-5xl mb-4">‚ùå</div>
                    <h2 class="text-2xl font-bold mb-2">${message}</h2>
                    <a href="search-real.html" class="text-blue-600 hover:underline">Back to Search</a>
                </div>
            `;
        }

        function generateIndeedLink(job) {
            const query = encodeURIComponent(`${job.title} ${companyName}`);
            const location = encodeURIComponent(job.location);
            return `https://www.indeed.com/jobs?q=${query}&l=${location}&from=${INDEED_PUBLISHER_ID}`;
        }

        function generateZipRecruiterLink(job) {
            const search = encodeURIComponent(job.title);
            const location = encodeURIComponent(job.location);
            return `https://www.ziprecruiter.com/candidate/search?search=${search}&location=${location}&aid=${ZIPRECRUITER_AID}`;
        }

        function generateGlassdoorLink(company) {
            const slug = company.toLowerCase().replace(/\s+/g, '-').replace(/[^a-z0-9-]/g, '');
            const target = `https://www.glassdoor.com/Overview/Working-at-${slug}.htm`;
            return `https://www.anrdoezrs.net/links/${CJ_AFFILIATE_ID}/type/dlg/${encodeURIComponent(target)}`;
        }

        function trackClick(platform) {
            const revenue = {
                indeed: '$0.75',
                ziprecruiter: '$10 (if registers)',
                glassdoor: '$1.50'
            };
            
            console.log(`%cüí∞ ${platform.toUpperCase()} Click!`, 
                'background: #10b981; color: white; font-size: 16px; font-weight: bold; padding: 4px 8px; border-radius: 4px',
                `You earn ${revenue[platform]}`
            );
        }

        loadJobDetails();
    </script>
</body>
</html>

